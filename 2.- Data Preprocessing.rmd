---
title: "Data Cleaning"
author: "Andrew.Z.Flores"
date: "4/12/2020"
output: html_document
---

```{r, libraries}
library(tidyverse)
```

```{r , load data, include=FALSE}

raw_mcdi <- read_csv("raw_mcdi.csv")

raw_childes <- read_csv("raw_childes.csv")

```

# MCDI 

## Data Exclusion
```{r, exclude_mcdi}
# Remove undesired item types.
exclude_types <- c(
  "how_use_words",
  "complexity",
  "word_endings",
  "combine",
  "word_endings_nouns",
  "word_endings_verbs"
)

mcdi <- raw_mcdi %>% filter(!type %in% exclude_types)

#remove definitions based on the following criteria:
#1)Remove from data if definition is compound word (e.g play dough).
#2)Include only a single item for words with multiple meaning (e.g can(object, can (auxiliary)))

remove_items <-
  c(
    "baa baa",
    "choo choo",
    "quack quack",
    "uh oh",
    "woof woof",
    "yum yum",
    "play dough",
    "chicken (food)",
    "fish (food)",
    "french fries",
    "green beans",
    "ice cream",
    "peanut butter",
    "potato chip",
    "belly button",
    "high chair",
    "living room",
    "rocking chair",
    "washing machine",
    "play pen",
    "lawn mower",
    "gas station",
    "babysitter's name",
    "child's own name",
    "pet's name",
    "give me five!",
    "gonna get you!",
    "go potty",
    "night night",
    "so big!",
    "thank you",
    "this little piggy",
    "turn around",
    "drink (action)",
    "slide (action)",
    "swing (action)",
    "watch (action)",
    "work (action)",
    "all gone",
    "clean (description)",
    "dry (description)",
    "orange (description)",
    "next to",
    "on top of",
    "a lot",
    "can (auxiliary)",
    "don't",
    "water (not beverage)"
  )

mcdi <- mcdi %>% filter(!definition %in% remove_items)

#Replaces specific word meaning (e.g "drink (beverage)" with lemma (drink))
mcdi$definition <-
  recode(
    mcdi$definition,
    "chicken (animal)" = "chicken",
    "fish (animal)" = "fish",
    "toy (object)" = "toy",
    "drink (beverage)" = "drink",
    "orange (food)" = "orange",
    "water (beverage)" = "water",
    "dress (object)" = "dress",
    "buttocks/bottom*" = "bottom",
    "owie/boo boo" = "owie",
    "penis*" = "penis",
    "vagina*" = "vagina",
    "can (object)" = "can",
    "tissue/kleenex" = "tissue",
    "watch (object)" = "watch",
    "slide (object)" = "slide",
    "swing (object)" = "swing" ,
    "church*" = "church",
    "work (place)" = "work",
    "daddy*" = "daddy",
    "grandma*" = "grandma",
    "grandpa*" = "granpa",
    "mommy*" = "mommy",
    "call (on phone)" = "call",
    "clean (action)" = "clean",
    "dry (action)" = "dry",
    "little (description)" = "little",
    "inside/in" = "inside",
    "did/did ya" = "did",
    "gonna/going to" = "gonna",
    "gotta/got to" = "gotta",
    "hafta/have to" = "hafta",
    "lemme/let me" = "lemme",
    "need/need to" = "need",
    "try/try to" = "try",
    "wanna/want to" = "wanna",
    "shh/shush/hush" = "hush",
    "soda/pop" = "soda"
  )


#Save data after excluded items
write.csv(mcdi, file = "clean_mcdi.binomial.csv")
```

## Calculate proportion of children who produce a word at each age group (MCDIp)
```{r, calculate_mcdip}

#Dichotomize "value". (produces = 1, else = 0)
mcdi <- mcdi %>% mutate(value = if_else(is.na(value), 0, 1))

#Calculate MCDIp scores 3 ways:
mcdi$value <- as.numeric(mcdi$value)

# MCDIp by word and age
MCDIp <-
  mcdi %>% group_by(definition, age) %>% summarize(MCDIp = mean(value, na.rm =
                                                                  TRUE))

# MCDIp by lexical_category and age
MCDIp_category <-
  mcdi %>% group_by(category, age) %>% summarize(MCDIp_category = mean(value, na.rm =
                                                                         TRUE))

# MCDIp by lexical_class and age
MCDIp_lex.class <-
  mcdi %>% group_by(lexical_class, age) %>% summarize(MCDIp_lex.class = mean(value, na.rm =
                                                                               TRUE))


# Save files
write.csv(MCDIp , file = "MCDIp.csv", row.names = FALSE)
write.csv(MCDIp_category , file = "MCDIp_category.csv", row.names = FALSE)
write.csv(MCDIp_lex.class , file = "MCDIp_lex.class.csv", row.names = FALSE)


```

### Merge calculated MCDIp values with raw mcdi dataset & save files.
```{r, merge_mcdi}

merged_mcdi <-
  mcdi %>% full_join(MCDIp) %>% full_join(MCDIp_category) %>% full_join(MCDIp_lex.class)

#Keep only relevant Columns & set desired names
prepared_mcdi <-
  merged_mcdi %>% select(
    data_id,
    age,
    value,
    definition,
    lexical_class,
    category,
    MCDIp,
    MCDIp_category,
    MCDIp_lex.class
  ) %>%  setNames(
    c(
      "data_id",
      "Age",
      "Produce",
      "Word",
      "Lexical_Class",
      "Category",
      "MCDIp",
      "MCDIp_category",
      "MCDIp_lex.class"
    )
  )

#keep only unique values
prepared_mcdi.unique <-prepared_mcdi %>% select(Age,Word,Lexical_Class,Category,MCDIp,MCDIp_category,MCDIp_lex.class) 

prepared_mcdi.unique <- unique(prepared_mcdi.unique)

# Save files
write.csv(prepared_mcdi.unique, file = "prepared_mcdi_unique.csv", row.names = FALSE)
write.csv(prepared_mcdi, file = "prepared_mcdi_raw.csv", row.names = FALSE)

```

# CHILDES
## Distributional Statistics computed using both cummulative and non-cummulative word co-occurences. 
```{r, load_distributional.stats}

# Cummulatice co-occurence data
Lexical_properties_cumul <- read.csv("predict_mcdi_cumul.csv")
Lexical_properties_cumul.bidirectional <- read.csv("predict_mcdi_cumul_bidirectional.csv")
```

```{r, rename_columns }
Lexical_properties_cumul <-
  setNames(
    Lexical_properties_cumul,
    c("Age", "Word", "MCDIp", "cumul_freq", "ld", "dd", "ProKWo")
  )

Lexical_properties_cumul.bidirectional <-
  setNames(
    Lexical_properties_cumul.bidirectional,
    c("Age", "Word", "MCDIp", "cumul_freq", "ld", "dd", "ProKWo")
  )

```

# Combine CHILDES & MCDI Datasets
## Unique (MCDIp)
```{r, combine_unique }

#MCDI
unique_mcdi <- read.csv("prepared_mcdi_unique.csv")
#lowercase all words
unique_mcdi$Word <- tolower(unique_mcdi$Word)

# Cummulative
unique_data.cumul <-
  full_join(unique_mcdi, Lexical_properties_cumul , by = c("Age", "Word"))

#  1.- Select relevant data and rename column names.
#  2.- Remove rows with 0 cummulative frequency
#  3.- Remove rows that include words of the lexical class "other"
unique_data.cumul <-
  unique_data.cumul %>% select(
    Age,
    Word,
    Lexical_Class,
    Category,
    MCDIp.x,
    MCDIp_category,
    MCDIp_lex.class,
    cumul_freq,
    ld,
    dd,
    ProKWo
  ) %>% setNames(
    c(
      "Age",
      "Word",
      "Lexical_Class",
      "Category",
      "MCDIp",
      "MCDIp_category",
      "MCDIp_lex.class",
      "Cummulative_Frequency",
      "Lexical_Diversity",
      "Document_Diversity",
      "ProKWo"
    )
  ) %>% filter (Cummulative_Frequency != 0) %>% filter(Lexical_Class != "other")

# Save final data
write.csv(unique_data.cumul, file = "preprocessed_unique_data.cumul.csv", row.names = F)
```

## Raw (produce/no produce)
```{r, combine_raw}
# raw_mcdi
raw_mcdi <- read.csv("prepared_mcdi_raw.csv")

#Lowercase all words
raw_mcdi$Word <- tolower(raw_mcdi$Word)

# Cummulative
raw_data.cumul <-
  full_join(raw_mcdi, Lexical_properties_cumul , by = c("Age", "Word"))

raw_data.cumul <-
  raw_data.cumul %>% select(
    data_id,
    Age,
    Word,
    Produce,
    Lexical_Class,
    Category,
    MCDIp.x,
    MCDIp_category,
    MCDIp_lex.class,
    cumul_freq,
    ld,
    dd,
    ProKWo
  ) %>% setNames(
    c("data_id",
      "Age",
      "Word",
      "Produce",
      "Lexical_Class",
      "Category",
      "MCDIp",
      "MCDIp_category",
      "MCDIp_lex.class",
      "Cummulative_Frequency",
      "Lexical_Diversity",
      "Document_Diversity",
      "ProKWo"
    )
  ) %>% filter (Cummulative_Frequency != 0) %>% filter(Lexical_Class != "other")

write.csv(raw_data.cumul, file = "preprocessed_raw_data.cumul.csv", row.names = F)
```

# CHILDES (Bi-directional co-occurence)
```{r, rename_columns }
Lexical_properties_cumul.bidirectional <-
  setNames(
    Lexical_properties_cumul.bidirectional,
    c("Age", "Word", "MCDIp", "cumul_freq", "ld", "dd", "ProKWo")
  )
```

# Combine CHILDES & MCDI Datasets
## Unique (MCDIp)
```{r, combine_unique }

#MCDI
unique_mcdi <- read.csv("prepared_mcdi_unique.csv")
#lowercase all words
unique_mcdi$Word <- tolower(unique_mcdi$Word)

# Cummulative
unique_data.cumul <-
  full_join(unique_mcdi, Lexical_properties_cumul.bidirectional , by = c("Age", "Word"))

#  1.- Select relevant data and rename column names.
#  2.- Remove rows with 0 cummulative frequency
#  3.- Remove rows that include words of the lexical class "other"
unique_data.cumul <-
  unique_data.cumul %>% select(
    Age,
    Word,
    Lexical_Class,
    Category,
    MCDIp.x,
    MCDIp_category,
    MCDIp_lex.class,
    cumul_freq,
    ld,
    dd,
    ProKWo
  ) %>% setNames(
    c(
      "Age",
      "Word",
      "Lexical_Class",
      "Category",
      "MCDIp",
      "MCDIp_category",
      "MCDIp_lex.class",
      "Cummulative_Frequency",
      "Lexical_Diversity",
      "Document_Diversity",
      "ProKWo"
    )
  ) %>% filter (Cummulative_Frequency != 0) %>% filter(Lexical_Class != "other")

# Save final data
write.csv(unique_data.cumul, file = "preprocessed_unique_data.cumul.bidirectional.csv", row.names = F)
```

## Raw (produce/no produce)
```{r, combine_raw}
# raw_mcdi
raw_mcdi <- read.csv("prepared_mcdi_raw.csv")

#Lowercase all words
raw_mcdi$Word <- tolower(raw_mcdi$Word)

# Cummulative
raw_data.cumul <-
  full_join(raw_mcdi, Lexical_properties_cumul.bidirectional , by = c("Age", "Word"))

raw_data.cumul <-
  raw_data.cumul %>% select(
    data_id,
    Age,
    Word,
    Produce,
    Lexical_Class,
    Category,
    MCDIp.x,
    MCDIp_category,
    MCDIp_lex.class,
    cumul_freq,
    ld,
    dd,
    ProKWo
  ) %>% setNames(
    c("data_id",
      "Age",
      "Word",
      "Produce",
      "Lexical_Class",
      "Category",
      "MCDIp",
      "MCDIp_category",
      "MCDIp_lex.class",
      "Cummulative_Frequency",
      "Lexical_Diversity",
      "Document_Diversity",
      "ProKWo"
    )
  ) %>% filter (Cummulative_Frequency != 0) %>% filter(Lexical_Class != "other")

write.csv(raw_data.cumul, file = "preprocessed_raw_data.cumul.bidirectional.csv", row.names = F)

```